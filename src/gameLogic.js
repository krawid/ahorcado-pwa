// Banco de palabras con 800 palabras en 8 categorías
export const WORD_BANK = {
  "Animales": [
    "PERRO", "GATO", "ELEFANTE", "LEON", "TIGRE", "OSO", "LOBO", "ZORRO", "CONEJO", "CABALLO",
    "VACA", "CERDO", "OVEJA", "CABRA", "GALLINA", "PATO", "GANSO", "PAVO", "PALOMA", "AGUILA",
    "HALCON", "BUHO", "LORO", "CANARIO", "PINGUINO", "FLAMENCO", "CISNE", "CUERVO", "GAVIOTA", "PELICANO",
    "DELFIN", "BALLENA", "TIBURON", "FOCA", "MORSA", "PULPO", "CALAMAR", "MEDUSA", "ESTRELLA", "CANGREJO",
    "LANGOSTA", "CAMARON", "SALMON", "ATUN", "TRUCHA", "SARDINA", "MERLUZA", "BACALAO", "ANCHOA", "ARENQUE",
    "SERPIENTE", "LAGARTO", "COCODRILO", "CAIMAN", "IGUANA", "TORTUGA", "SAPO", "RANA", "SALAMANDRA", "GECKO",
    "ARAÑA", "MOSCA", "MOSQUITO", "ABEJA", "AVISPA", "HORMIGA", "MARIPOSA", "LIBELULA", "GRILLO", "SALTAMONTES",
    "ESCARABAJO", "MARIQUITA", "CUCARACHA", "TERMITA", "PULGA", "GARRAPATA", "ESCORPION", "CIEMPIES", "CARACOL", "BABOSA",
    "JIRAFA", "CEBRA", "HIPOPOTAMO", "RINOCERONTE", "GORILA", "CHIMPANCE", "ORANGUTAN", "MONO", "LEMUR", "KOALA",
    "CANGURO", "ORNITORRINCO", "WOMBAT", "PANDA", "MAPACHE", "MOFETA", "CASTOR", "NUTRIA", "ARDILLA", "RATON"
  ],
  "Paises": [
    "ESPAÑA", "FRANCIA", "ALEMANIA", "ITALIA", "PORTUGAL", "GRECIA", "SUIZA", "AUSTRIA", "BELGICA", "HOLANDA",
    "DINAMARCA", "SUECIA", "NORUEGA", "FINLANDIA", "ISLANDIA", "IRLANDA", "ESCOCIA", "GALES", "INGLATERRA", "POLONIA",
    "RUSIA", "UCRANIA", "RUMANIA", "BULGARIA", "HUNGRIA", "CHEQUIA", "ESLOVAQUIA", "CROACIA", "SERBIA", "BOSNIA",
    "ALBANIA", "MACEDONIA", "MONTENEGRO", "ESLOVENIA", "LITUANIA", "LETONIA", "ESTONIA", "BIELORRUSIA", "MOLDAVIA", "GEORGIA",
    "ARMENIA", "AZERBAIYAN", "TURQUIA", "CHIPRE", "MALTA", "LUXEMBURGO", "MONACO", "LIECHTENSTEIN", "ANDORRA", "VATICANO",
    "MEXICO", "GUATEMALA", "HONDURAS", "SALVADOR", "NICARAGUA", "COSTARICA", "PANAMA", "CUBA", "JAMAICA", "HAITI",
    "DOMINICANA", "BAHAMAS", "BARBADOS", "TRINIDAD", "VENEZUELA", "COLOMBIA", "ECUADOR", "PERU", "BOLIVIA", "CHILE",
    "ARGENTINA", "URUGUAY", "PARAGUAY", "BRASIL", "GUYANA", "SURINAM", "CANADA", "ALASKA", "GROENLANDIA", "ISLANDIA",
    "CHINA", "JAPON", "COREA", "MONGOLIA", "VIETNAM", "TAILANDIA", "BIRMANIA", "LAOS", "CAMBOYA", "MALASIA",
    "SINGAPUR", "INDONESIA", "FILIPINAS", "INDIA", "PAKISTAN", "BANGLADESH", "NEPAL", "BUTAN", "MALDIVAS", "SRILANKA"
  ],
  "Frutas": [
    "MANZANA", "PERA", "PLATANO", "NARANJA", "LIMON", "LIMA", "POMELO", "MANDARINA", "KIWI", "MANGO",
    "PAPAYA", "PIÑA", "COCO", "SANDIA", "MELON", "FRESA", "FRAMBUESA", "MORA", "ARANDANO", "CEREZA",
    "CIRUELA", "MELOCOTON", "ALBARICOQUE", "NECTARINA", "HIGO", "DATIL", "UVA", "PASA", "GRANADA", "CAQUI",
    "CHIRIMOYA", "GUAYABA", "MARACUYA", "CARAMBOLA", "LITCHI", "RAMBUTAN", "MANGOSTEEN", "DURIAN", "PITAYA", "ACAI",
    "AGUACATE", "TOMATE", "PEPINO", "CALABAZA", "CALABACIN", "BERENJENA", "PIMIENTO", "GUINDILLA", "ACEITUNA", "ALCAPARRA",
    "MEMBRILLO", "NISPERO", "KUMQUAT", "BERGAMOTA", "YUZU", "CIDRA", "TORONJA", "CLEMENTINA", "TANGELO", "MINNEOLA",
    "GROSELLA", "ARONIA", "ESCARAMUJO", "ENDRINO", "MADROÑO", "SERBAL", "ACEROLA", "FEIJOA", "JABUTICABA", "CUPUACU",
    "TAMARINDO", "JACA", "ZAPOTE", "MAMEY", "LUCUMA", "CHERIMOYA", "ATEMOYA", "SOURSOP", "LONGAN", "PERSIMMON",
    "KUMQUAT", "PHYSALIS", "UCHUVA", "TOMATILLO", "PEPINO", "MELOA", "CANTALUPO", "HONEYDEW", "CASABA", "CRENSHAW",
    "BOYSENBERRY", "LOGANBERRY", "TAYBERRY", "CLOUDBERRY", "SALMONBERRY", "THIMBLEBERRY", "WINEBERRY", "MULBERRY", "ELDERBERRY", "HACKBERRY"
  ],
  "Colores": [
    "ROJO", "AZUL", "VERDE", "AMARILLO", "NARANJA", "MORADO", "ROSA", "MARRON", "NEGRO", "BLANCO",
    "GRIS", "BEIGE", "TURQUESA", "VIOLETA", "INDIGO", "MAGENTA", "CYAN", "LIMA", "OLIVA", "AGUAMARINA",
    "CORAL", "SALMON", "MELOCOTON", "CREMA", "MARFIL", "PERLA", "PLATA", "ORO", "BRONCE", "COBRE",
    "ESMERALDA", "JADE", "ZAFIRO", "RUBI", "AMATISTA", "TOPACIO", "GRANATE", "OPALO", "AMBAR", "ONIX",
    "CARMESI", "ESCARLATA", "BERMELLÓN", "GRANATE", "BORGOÑA", "VINO", "CEREZA", "FRAMBUESA", "FRESA", "SANDÍA",
    "LAVANDA", "LILA", "MALVA", "CIRUELA", "BERENJENA", "UVA", "MORA", "ARÁNDANO", "VIOLETA", "PÚRPURA",
    "CELESTE", "CIELO", "MARINO", "NAVY", "COBALTO", "AÑIL", "ZAFIRO", "CERÚLEO", "ACERO", "PIZARRA",
    "MENTA", "PISTACHO", "MUSGO", "BOSQUE", "PINO", "ESMERALDA", "JADE", "MALAQUITA", "VERDE", "OLIVA",
    "CANELA", "CARAMELO", "CHOCOLATE", "CAFÉ", "TOSTADO", "CASTAÑO", "SEPIA", "TIERRA", "ARENA", "DESIERTO",
    "CARBÓN", "ÉBANO", "OBSIDIANA", "GRAFITO", "HUMO", "CENIZA", "NIEBLA", "NUBE", "NIEVE", "HIELO"
  ],
  "Deportes": [
    "FUTBOL", "BALONCESTO", "TENIS", "VOLEIBOL", "BALONMANO", "RUGBY", "HOCKEY", "BEISBOL", "CRICKET", "GOLF",
    "NATACION", "ATLETISMO", "CICLISMO", "BOXEO", "JUDO", "KARATE", "TAEKWONDO", "ESGRIMA", "LUCHA", "HALTEROFILIA",
    "GIMNASIA", "TRAMPOLÍN", "ESCALADA", "SURF", "ESQUI", "SNOWBOARD", "PATINAJE", "BOBSLEIGH", "SKELETON", "LUGE",
    "REMO", "PIRAGÜISMO", "VELA", "WINDSURF", "KITESURF", "WATERPOLO", "BUCEO", "TRIATLÓN", "PENTATLÓN", "DECATLÓN",
    "MARATON", "VELOCIDAD", "VALLAS", "SALTO", "LANZAMIENTO", "MARTILLO", "JABALINA", "DISCO", "PESO", "PÉRTIGA",
    "EQUITACION", "POLO", "RODEO", "DOMA", "SALTO", "CONCURSO", "RAID", "ENDURO", "CROSS", "TROTE",
    "AUTOMOVILISMO", "MOTOCICLISMO", "KARTING", "RALLY", "FORMULA", "NASCAR", "DRAGSTER", "TRIAL", "ENDURO", "MOTOCROSS",
    "TIRO", "ARQUERIA", "CAZA", "PESCA", "BILLAR", "BOLOS", "DARDOS", "PETANCA", "BOCHAS", "CROQUET",
    "BADMINTON", "SQUASH", "PADEL", "TENIS", "PING", "PONG", "FRONTÓN", "PELOTA", "JAI", "ALAI",
    "AJEDREZ", "DAMAS", "GO", "BACKGAMMON", "POKER", "BRIDGE", "SCRABBLE", "MONOPOLY", "RISK", "DOMINO"
  ],
  "Profesiones": [
    "MEDICO", "ENFERMERO", "CIRUJANO", "DENTISTA", "FARMACEUTICO", "VETERINARIO", "PSICOLOGO", "PSIQUIATRA", "TERAPEUTA", "FISIOTERAPEUTA",
    "PROFESOR", "MAESTRO", "EDUCADOR", "TUTOR", "INSTRUCTOR", "ENTRENADOR", "COACH", "MENTOR", "PEDAGOGO", "DOCENTE",
    "INGENIERO", "ARQUITECTO", "CONSTRUCTOR", "ALBAÑIL", "CARPINTERO", "ELECTRICISTA", "FONTANERO", "PINTOR", "SOLDADOR", "MECANICO",
    "ABOGADO", "JUEZ", "FISCAL", "NOTARIO", "PROCURADOR", "LETRADO", "JURISTA", "MAGISTRADO", "SECRETARIO", "UJIER",
    "CONTADOR", "AUDITOR", "ECONOMISTA", "FINANCIERO", "BANQUERO", "CORREDOR", "AGENTE", "ASESOR", "CONSULTOR", "ANALISTA",
    "PROGRAMADOR", "DESARROLLADOR", "DISEÑADOR", "ANALISTA", "ADMINISTRADOR", "INGENIERO", "ARQUITECTO", "TESTER", "DEVOPS", "SCRUM",
    "PERIODISTA", "REPORTERO", "EDITOR", "REDACTOR", "COLUMNISTA", "CRITICO", "COMENTARISTA", "LOCUTOR", "PRESENTADOR", "ANCLA",
    "ARTISTA", "PINTOR", "ESCULTOR", "FOTOGRAFO", "ILUSTRADOR", "DIBUJANTE", "GRABADOR", "CERAMISTA", "ORFEBRE", "JOYERO",
    "MUSICO", "CANTANTE", "COMPOSITOR", "DIRECTOR", "PIANISTA", "GUITARRISTA", "VIOLINISTA", "BATERISTA", "BAJISTA", "SAXOFONISTA",
    "ACTOR", "ACTRIZ", "DIRECTOR", "PRODUCTOR", "GUIONISTA", "CINEASTA", "CAMAROGRAFO", "EDITOR", "SONIDISTA", "ILUMINADOR"
  ],
  "Ciudades": [
    "MADRID", "BARCELONA", "VALENCIA", "SEVILLA", "ZARAGOZA", "MALAGA", "MURCIA", "PALMA", "BILBAO", "ALICANTE",
    "CORDOBA", "VALLADOLID", "VIGO", "GIJON", "HOSPITALET", "CORUÑA", "VITORIA", "GRANADA", "ELCHE", "OVIEDO",
    "BADALONA", "CARTAGENA", "TERRASSA", "JEREZ", "SABADELL", "MOSTOLES", "SANTACRUZ", "PAMPLONA", "ALMERIA", "FUENLABRADA",
    "PARIS", "LONDRES", "BERLIN", "ROMA", "ATENAS", "AMSTERDAM", "BRUSELAS", "VIENA", "PRAGA", "BUDAPEST",
    "VARSOVIA", "BUCAREST", "ESTOCOLMO", "COPENHAGUE", "HELSINKI", "OSLO", "DUBLIN", "LISBOA", "MOSCU", "KIEV",
    "NUEVA", "YORK", "ANGELES", "CHICAGO", "HOUSTON", "PHOENIX", "FILADELFIA", "ANTONIO", "DIEGO", "DALLAS",
    "TORONTO", "MONTREAL", "VANCOUVER", "CALGARY", "OTTAWA", "EDMONTON", "WINNIPEG", "QUEBEC", "HAMILTON", "KITCHENER",
    "MEXICO", "GUADALAJARA", "MONTERREY", "PUEBLA", "TIJUANA", "LEON", "JUAREZ", "ZAPOPAN", "NEZAHUALCOYOTL", "CHIHUAHUA",
    "BOGOTA", "MEDELLIN", "CALI", "BARRANQUILLA", "CARTAGENA", "CUCUTA", "BUCARAMANGA", "PEREIRA", "IBAGUE", "MANIZALES",
    "LIMA", "AREQUIPA", "TRUJILLO", "CHICLAYO", "PIURA", "IQUITOS", "CUSCO", "HUANCAYO", "TACNA", "ICA"
  ],
  "Comida": [
    "PIZZA", "PASTA", "ARROZ", "PAN", "QUESO", "JAMON", "CHORIZO", "SALCHICHA", "HAMBURGUESA", "HOTDOG",
    "TACO", "BURRITO", "ENCHILADA", "QUESADILLA", "NACHOS", "GUACAMOLE", "SALSA", "TORTILLA", "FAJITA", "CHIMICHANGA",
    "SUSHI", "SASHIMI", "TEMPURA", "RAMEN", "UDON", "SOBA", "YAKITORI", "TERIYAKI", "SUKIYAKI", "SHABU",
    "CURRY", "TANDOORI", "BIRYANI", "SAMOSA", "PAKORA", "NAAN", "CHAPATI", "PARATHA", "DOSA", "IDLI",
    "PAELLA", "GAZPACHO", "TORTILLA", "CROQUETA", "EMPANADA", "TAPA", "PINCHO", "BOCADILLO", "MONTADITO", "TOSTAS",
    "CROISSANT", "BAGUETTE", "BRIOCHE", "MACARON", "ECLAIR", "CREPE", "QUICHE", "SOUFFLE", "RATATOUILLE", "CASSOULET",
    "LASAÑA", "RAVIOLI", "GNOCCHI", "RISOTTO", "POLENTA", "FOCACCIA", "BRUSCHETTA", "CARPACCIO", "PROSCIUTTO", "PARMESANO",
    "KEBAB", "FALAFEL", "HUMMUS", "TABULE", "BAKLAVA", "DOLMA", "SHAWARMA", "MEZZE", "LABNEH", "HALLOUMI",
    "TACOS", "CEVICHE", "AREPAS", "PUPUSAS", "TAMALES", "MOLE", "POZOLE", "MENUDO", "BIRRIA", "CARNITAS",
    "CHURRASCO", "ASADO", "EMPANADAS", "CHORIPAN", "MILANESA", "LOCRO", "HUMITA", "ALFAJOR", "DULCE", "MATE"
  ]
};

/**
 * Clase que gestiona la lógica del juego del ahorcado
 */
export class HangmanGame {
  /**
   * Constructor de la clase HangmanGame
   * @param {Object} settings - Configuración del juego
   * @param {string} settings.category - Categoría de palabras
   * @param {string} settings.difficulty - Nivel de dificultad ('Fácil', 'Normal', 'Difícil')
   * @param {boolean} settings.soundEnabled - Si el sonido está habilitado
   */
  constructor(settings = {}) {
    this.category = settings.category || "Animales";
    this.difficulty = settings.difficulty || "Normal";
    this.soundEnabled = settings.soundEnabled !== undefined ? settings.soundEnabled : true;
    
    // Estado del juego
    this.word = "";
    this.guessedLetters = new Set();
    this.maxAttempts = this.getMaxAttemptsForDifficulty(this.difficulty);
    this.attemptsLeft = this.maxAttempts;
    this.gameOver = false;
    this.won = false;
    this.lastMessage = "";
  }

  /**
   * Obtiene el número máximo de intentos según la dificultad
   * @param {string} difficulty - Nivel de dificultad
   * @returns {number} Número máximo de intentos
   */
  getMaxAttemptsForDifficulty(difficulty) {
    const difficultyMap = {
      "Fácil": 8,
      "Normal": 6,
      "Difícil": 4
    };
    return difficultyMap[difficulty] || 6;
  }

  /**
   * Inicia un nuevo juego
   * @param {string} category - Categoría opcional (usa la actual si no se especifica)
   * @returns {Object} Resultado de la operación
   */
  startNewGame(category) {
    if (category) {
      this.category = category;
    }

    // Verificar que la categoría existe
    if (!WORD_BANK[this.category] || WORD_BANK[this.category].length === 0) {
      return {
        success: false,
        message: `La categoría "${this.category}" no tiene palabras disponibles.`
      };
    }

    // Seleccionar palabra aleatoria
    const words = WORD_BANK[this.category];
    this.word = words[Math.floor(Math.random() * words.length)];

    // Reiniciar estado del juego
    this.guessedLetters = new Set();
    this.maxAttempts = this.getMaxAttemptsForDifficulty(this.difficulty);
    this.attemptsLeft = this.maxAttempts;
    this.gameOver = false;
    this.won = false;
    this.lastMessage = "¡Nuevo juego iniciado!";

    return {
      success: true,
      message: this.lastMessage
    };
  }

  /**
   * Procesa un intento de adivinar una letra
   * @param {string} letter - Letra a adivinar
   * @returns {Object} Resultado del intento
   */
  guessLetter(letter) {
    // Validar que el juego no ha terminado
    if (this.gameOver) {
      return {
        success: false,
        message: "El juego ha terminado. Inicia un nuevo juego."
      };
    }

    // Normalizar la letra (mayúscula)
    letter = letter.toUpperCase();

    // Validar que es una letra
    if (!/^[A-ZÁÉÍÓÚÑ]$/.test(letter)) {
      this.lastMessage = "Por favor, ingresa solo letras.";
      return {
        success: false,
        message: this.lastMessage
      };
    }

    // Verificar si la letra ya fue usada
    if (this.guessedLetters.has(letter)) {
      this.lastMessage = `Ya has usado la letra "${letter}".`;
      return {
        success: false,
        message: this.lastMessage
      };
    }

    // Agregar letra a las usadas
    this.guessedLetters.add(letter);

    // Verificar si la letra está en la palabra
    if (this.word.includes(letter)) {
      this.lastMessage = `¡Correcto! La letra "${letter}" está en la palabra.`;
      
      // Verificar si se completó la palabra
      if (this.isWordComplete()) {
        this.gameOver = true;
        this.won = true;
        this.lastMessage = `¡Felicidades! Has ganado. La palabra era "${this.word}".`;
      }

      return {
        success: true,
        message: this.lastMessage,
        correct: true
      };
    } else {
      this.attemptsLeft--;
      this.lastMessage = `Incorrecto. La letra "${letter}" no está en la palabra. Te quedan ${this.attemptsLeft} intentos.`;

      // Verificar si se acabaron los intentos
      if (this.attemptsLeft === 0) {
        this.gameOver = true;
        this.won = false;
        this.lastMessage = `Has perdido. La palabra era "${this.word}".`;
      }

      return {
        success: true,
        message: this.lastMessage,
        correct: false
      };
    }
  }

  /**
   * Procesa un intento de adivinar la palabra completa
   * @param {string} word - Palabra a adivinar
   * @returns {Object} Resultado del intento
   */
  guessWord(word) {
    // Validar que el juego no ha terminado
    if (this.gameOver) {
      return {
        success: false,
        message: "El juego ha terminado. Inicia un nuevo juego."
      };
    }

    // Normalizar la palabra (mayúsculas)
    word = word.toUpperCase().trim();

    // Validar que solo contiene letras
    if (!/^[A-ZÁÉÍÓÚÑ]+$/.test(word)) {
      this.lastMessage = "Por favor, ingresa solo letras.";
      return {
        success: false,
        message: this.lastMessage
      };
    }

    // Comparar con la palabra objetivo (case-insensitive)
    if (word === this.word) {
      this.gameOver = true;
      this.won = true;
      this.lastMessage = `¡Felicidades! Has adivinado la palabra "${this.word}".`;
      
      // Marcar todas las letras como adivinadas
      for (let letter of this.word) {
        this.guessedLetters.add(letter);
      }

      return {
        success: true,
        message: this.lastMessage,
        correct: true
      };
    } else {
      this.attemptsLeft--;
      this.lastMessage = `Incorrecto. "${word}" no es la palabra. Te quedan ${this.attemptsLeft} intentos.`;

      // Verificar si se acabaron los intentos
      if (this.attemptsLeft === 0) {
        this.gameOver = true;
        this.won = false;
        this.lastMessage = `Has perdido. La palabra era "${this.word}".`;
      }

      return {
        success: true,
        message: this.lastMessage,
        correct: false
      };
    }
  }

  /**
   * Proporciona una pista revelando una letra no adivinada
   * @returns {Object} Resultado de la operación
   */
  getHint() {
    // Validar que el juego no ha terminado
    if (this.gameOver) {
      return {
        success: false,
        message: "El juego ha terminado. Inicia un nuevo juego."
      };
    }

    // Validar que hay suficientes intentos
    if (this.attemptsLeft <= 1) {
      this.lastMessage = "No puedes pedir pistas cuando te queda 1 intento o menos.";
      return {
        success: false,
        message: this.lastMessage
      };
    }

    // Obtener letras no adivinadas
    const unguessedLetters = [];
    for (let letter of this.word) {
      if (!this.guessedLetters.has(letter) && !unguessedLetters.includes(letter)) {
        unguessedLetters.push(letter);
      }
    }

    // Verificar si hay letras disponibles
    if (unguessedLetters.length === 0) {
      this.lastMessage = "Ya has adivinado todas las letras.";
      return {
        success: false,
        message: this.lastMessage
      };
    }

    // Seleccionar letra aleatoria
    const hintLetter = unguessedLetters[Math.floor(Math.random() * unguessedLetters.length)];
    this.guessedLetters.add(hintLetter);
    this.attemptsLeft--;

    this.lastMessage = `Pista: La letra "${hintLetter}" está en la palabra. Te quedan ${this.attemptsLeft} intentos.`;

    // Verificar si se completó la palabra
    if (this.isWordComplete()) {
      this.gameOver = true;
      this.won = true;
      this.lastMessage = `¡Felicidades! Has ganado con ayuda de pistas. La palabra era "${this.word}".`;
    }

    return {
      success: true,
      message: this.lastMessage,
      letter: hintLetter
    };
  }

  /**
   * Verifica si todas las letras de la palabra han sido adivinadas
   * @returns {boolean} True si la palabra está completa
   */
  isWordComplete() {
    for (let letter of this.word) {
      if (!this.guessedLetters.has(letter)) {
        return false;
      }
    }
    return true;
  }

  /**
   * Obtiene la representación visual de la palabra con letras adivinadas
   * @returns {string} Palabra con guiones bajos para letras no adivinadas
   */
  getDisplayWord() {
    return this.word
      .split('')
      .map(letter => this.guessedLetters.has(letter) ? letter : '_')
      .join(' ');
  }

  /**
   * Obtiene la palabra en formato para lectores de pantalla
   * @returns {string[]} Array con cada letra o guión bajo
   */
  getDisplayWordForSpeech() {
    return this.word
      .split('')
      .map(letter => this.guessedLetters.has(letter) ? letter : 'guión bajo');
  }

  /**
   * Obtiene el estado completo del juego
   * @returns {Object} Estado actual del juego
   */
  getGameState() {
    return {
      word: this.word,
      category: this.category,
      difficulty: this.difficulty,
      guessedLetters: Array.from(this.guessedLetters).sort(),
      maxAttempts: this.maxAttempts,
      attemptsLeft: this.attemptsLeft,
      gameOver: this.gameOver,
      won: this.won,
      lastMessage: this.lastMessage,
      displayWord: this.getDisplayWord()
    };
  }
}
